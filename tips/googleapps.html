<!DOCTYPE html>





<html lang="ja">

<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  
    
    スプレッドシートを使った難易度表の管理
  
 | Hex bms</title>



<link rel="stylesheet" href="/book.min.470eb34fba1e168575bd03a3e98a68d6e8e71115e9ab2e8aedd4abed222cab60.css">





<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->

  
</head>

<body>
  <input type="checkbox" style="display: none" id="menu-control" />
  <main class="flex container">

    <aside class="book-menu fixed">
      <nav>
<h2 class="book-brand">
  
  <a href="https://bms.hexlataia.xyz/">Hex bms</a>
</h2>




    

  






  <ul>
  
    

  <li  >
    
      <span>
  
    
    
    難易度表
  
</span>
    

    

  <ul>
    
    
    <li >
      

  <a href="/tables/hexajoy.html" >
    
  
    
    Hexajoy
  

  </a>


    </li>
    
    <li >
      

  <a href="/tables/tanosi.html" >
    
  
    
    ジャパリパーク
  

  </a>


    </li>
    
    <li >
      

  <a href="/tables/sandbox.html" >
    
  
    
    砂場
  

  </a>


    </li>
    
    <li >
      

  <a href="/tables/hinanjoy.html" >
    
  
    
    BMS差分アップローダー表
  

  </a>


    </li>
    
    <li  class="nazo" >
      

  <a href="/tables/olduploader.html" >
    
  
    
    旧アプロダ表
  

  </a>


    </li>
    
    <li  class="nazo" >
      

  <a href="/tables/db.html" >
    
  
    
    発狂難易度データベース（仮）
  

  </a>


    </li>
    
    <li >
      

  <a href="/tables/convert/" >
    
  
    
    勝手に json 化
  

  </a>


    </li>
    
  </ul>


  </li>


  
    

  <li  >
    
      <span>
  
    
    
    メモ
  
</span>
    

    

  <ul>
    
    
    <li >
      

  <a href="/tips/googleapps.html"  class="active">
    
  
    
    スプレッドシートを使った難易度表の管理
  

  </a>


    </li>
    
    <li >
      

  <a href="/tips/glassist.html" >
    
  
    
    GLAssistの差分自動導入
  

  </a>


    </li>
    
    <li >
      

  <a href="/tips/customfolder.html" >
    
  
    
    カスタムフォルダのメモ
  

  </a>


    </li>
    
  </ul>


  </li>


  
    

  <li  >
    
      <span>
  
    
    
    スキン
  
</span>
    

    

  <ul>
    
    
    <li >
      

  <a href="/skin/editorskin.html" >
    
  
    
    BMSエディタ用スキン
  

  </a>


    </li>
    
    <li >
      

  <a href="/skin/viewerskin.html" >
    
  
    
    BMSビューア用スキン
  

  </a>


    </li>
    
  </ul>


  </li>


  
    

  <li  >
    
      <span>
  
    
    
    その他
  
</span>
    

    

  <ul>
    
    
    <li >
      

  <a href="/others/sabunlist.html" >
    
  
    
    差分公開サイトまとめ
  

  </a>


    </li>
    
    <li  class="nazo" >
      

  <a href="/others/memo.html" >
    
  
    
    落書き帳
  

  </a>


    </li>
    
  </ul>


  </li>


  
  </ul>











</nav>


  
<script>
(function() {
  var menu = document.querySelector('aside.book-menu nav')
  addEventListener('beforeunload', function(event) {
    localStorage.setItem('menu.scrollTop', menu.scrollTop)
  });
  menu.scrollTop = localStorage.getItem('menu.scrollTop')
})()
</script>



    </aside>

    <div class="book-page">
      <header class="align-center justify-between book-header">
  <label for="menu-control">
    <img src="/svg/menu.svg" alt="Menu" />
  </label>
  <strong>
  
    
    スプレッドシートを使った難易度表の管理
  
</strong>
</header>

      
<article class="markdown">

<h1 id="スプレッドシートを使って難易度表を管理する">スプレッドシートを使って難易度表を管理する</h1>

<p>難易度表のデータ部をスプレッドシートを用いて管理します</p>

<h2 id="できること">できること</h2>

<p><a href="https://developers.google.com/apps-script/">GAS（Google Apps Script）</a> を使ってスプレッドシートのデータをJSONで取得します</p>

<p>↓こんなシートを書いたら</p>

<p><img src="/tips/img/sheet_ex.png" alt="" /></p>

<p>↓これが取得できるURLを作れます</p>

<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">[
  {
    <span style="color:#062873;font-weight:bold">&#34;level&#34;</span>: <span style="color:#4070a0">&#34;1&#34;</span>,
    <span style="color:#062873;font-weight:bold">&#34;title&#34;</span>: <span style="color:#4070a0">&#34;星の器～STAR OF ANDROMEDA (ANOTHER)&#34;</span>,
    <span style="color:#062873;font-weight:bold">&#34;artist&#34;</span>: <span style="color:#4070a0">&#34;ZUN (Arr.sun3)&#34;</span>,
    <span style="color:#062873;font-weight:bold">&#34;comment&#34;</span>: <span style="color:#4070a0">&#34;コメント1&#34;</span>,
    <span style="color:#062873;font-weight:bold">&#34;md5&#34;</span>: <span style="color:#4070a0">&#34;f8dcdfe070630bbb365323c662561a1a&#34;</span>,
    <span style="color:#062873;font-weight:bold">&#34;url_diff&#34;</span>: <span style="color:#4070a0">&#34;https://drive.google.com/...&#34;</span>
  },
  {
    <span style="color:#062873;font-weight:bold">&#34;level&#34;</span>: <span style="color:#4070a0">&#34;20&#34;</span>,
    <span style="color:#062873;font-weight:bold">&#34;title&#34;</span>: <span style="color:#4070a0">&#34;Air -GOD-&#34;</span>,
    <span style="color:#062873;font-weight:bold">&#34;artist&#34;</span>: <span style="color:#4070a0">&#34;SHIKI / black train&#34;</span>,
    <span style="color:#062873;font-weight:bold">&#34;comment&#34;</span>: <span style="color:#4070a0">&#34;コメント2&#34;</span>,
    <span style="color:#062873;font-weight:bold">&#34;md5&#34;</span>: <span style="color:#4070a0">&#34;751738dea1169c5c39db935adfc9e85f&#34;</span>,
    <span style="color:#062873;font-weight:bold">&#34;url_diff&#34;</span>: <span style="color:#4070a0">&#34;https://drive.google.com/...&#34;</span>
  }
]</code></pre></div>

<p>この方法を、難易度表のデータ部に用いることで、
難易度表のデータ部とスプレッドシートを自動的に同期することができます。</p>

<p>つまり、<strong>難易度表の更新作業をスプレッドシートのみで行うことができるようになります。</strong> 便利！すごい！！</p>

<h2 id="手順">手順</h2>

<ol>
<li>スプレッドシートを作成する</li>
<li>スクリプトを作成する</li>
<li>ウェブアプリケーションとして公開する</li>
</ol>

<h2 id="スプレッドシートを作成する">スプレッドシートを作成する</h2>

<p><a href="https://docs.google.com/spreadsheets/u/0/">スプレッドシートを作成</a>し、難易度表のデータ部の情報を入力します。</p>

<p>このとき1行目には、データ部の json のオブジェクトキーを入力します。<a href="https://github.com/exch-bms2/jbmstable-parser/wiki/%E9%9B%A3%E6%98%93%E5%BA%A6%E8%A1%A8%E3%81%AE%E4%BB%95%E6%A7%98">次期難易度表フォーマットの仕様の詳細はこちら</a>。</p>

<p>2行目以降にデータを入力していきます。書式等は好きにいじっても大丈夫です。また、関数の使用も問題ありません。</p>

<p><img src="/tips/img/sheet_ex.png" alt="" /></p>

<h2 id="シートのidとシート名をメモする">シートのIDとシート名をメモする</h2>

<p>シートのIDとシート名をメモしておきます</p>

<p>シートのURLが</p>

<blockquote>
<p>https://docs.google.com/spreadsheets/d/<strong>xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx</strong>/edit#gid=0000000000</p>
</blockquote>

<p>なら<code>xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx</code>がシートのIDとなります</p>

<p>シート名はシート下部のタブの名前となります（デフォルトはシート1）</p>

<p><img src="/tips/img/sheet_ex3.png" alt="" /> <img src="/tips/img/sheet_ex4.png" alt="" /></p>

<h2 id="スクリプトを作成する">スクリプトを作成する</h2>

<p>スプレッドシートのデータを json 形式で取得するスクリプトを GAS を用いて作成します。</p>

<p>メニューの <code>[ツール] &gt; [スクリプトエディタ...]</code> からスクリプトエディタを開きます。</p>

<p>スクリプトエディタに下記のコードを入力します。</p>

<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#007020;font-weight:bold">function</span> getSheetAsObj(id, sheet_name) {
  <span style="color:#007020;font-weight:bold">var</span> sheet <span style="color:#666">=</span> SpreadsheetApp.openById(id).getSheetByName(sheet_name);
  <span style="color:#007020;font-weight:bold">var</span> rows <span style="color:#666">=</span> sheet.getDataRange().getValues();
  <span style="color:#007020;font-weight:bold">var</span> keys <span style="color:#666">=</span> rows.splice(<span style="color:#40a070">0</span>, <span style="color:#40a070">1</span>)[<span style="color:#40a070">0</span>];
  <span style="color:#007020;font-weight:bold">return</span> rows.map(<span style="color:#007020;font-weight:bold">function</span>(row) {
    <span style="color:#007020;font-weight:bold">var</span> obj <span style="color:#666">=</span> {}
    row.map(<span style="color:#007020;font-weight:bold">function</span>(item, index) {
      obj[keys[index]] <span style="color:#666">=</span> <span style="color:#007020">String</span>(item);
    });
    <span style="color:#007020;font-weight:bold">return</span> obj;
  });
}

<span style="color:#007020;font-weight:bold">function</span> doGet() {
<span style="display:block;width:100%;background-color:#d8d8d8">  <span style="color:#007020;font-weight:bold">var</span> obj <span style="color:#666">=</span> getSheetAsObj(<span style="color:#4070a0">&#39;xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx&#39;</span>, <span style="color:#4070a0">&#39;シート1&#39;</span>);
</span>  <span style="color:#007020;font-weight:bold">return</span> ContentService.createTextOutput(JSON.stringify(obj, <span style="color:#007020;font-weight:bold">null</span>, <span style="color:#40a070">2</span>)).setMimeType(ContentService.MimeType.JSON);
}
</code></pre></div>

<p>このとき 上記のコードの <code>('xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx', 'シート1')</code> の部分を先程メモしたシートIDとシート名に変更してください</p>

<p>プロジェクトを適当な名前で保存します</p>

<h2 id="ウェブアプリケーションとして公開する">ウェブアプリケーションとして公開する</h2>

<p>作成したスクリプトをウェブアプリケーションとして公開します</p>

<p>このウェブアプリケーションにアクセスすることで外部からスプレッドシートのデータを json 形式で取得できるようになります</p>

<ol>
<li><p>メニューの <code>[公開] &gt; [ウェブアプリケーションとして導入...]</code> を選ぶ</p></li>

<li><p><code>「プロジェクト バージョン」</code> を <code>「新規作成」</code> に設定　説明欄は適当に入力</p></li>

<li><p><code>「次のユーザーとしてアプリケーションを実行」</code> を <code>「自分」</code> に設定</p></li>

<li><p><code>「アプリケーションにアクセスできるユーザー」</code> を <code>「全員（匿名ユーザーを含む）」</code> に設定</p></li>

<li><p><code>「導入」</code>をクリックして公開。</p></li>
</ol>

<p><img src="/tips/img/webapp.png" alt="" /></p>

<p>承認が必要になるので許可してください。</p>

<p>Googleの検閲がまだ通ってない場合、このアプリは確認されていませんと出ることがあります。
この場合は暫く時間を置き検閲が通るのを待つか、詳細から移動をクリックしてウェブアプリケーションに移動してください。</p>

<p><code>「現在のウェブアプリケーションのURL」</code>にアクセスするとスプレッドシートのデータを json 形式で取得できます。</p>

<p>ファイルがありませんというエラー出る場合はスプレッドシートを一度開き直すとうまくいくと思います。</p>

<p><img src="/tips/img/json.png" alt="" /></p>

<h2 id="難易度表に登録する">難易度表に登録する</h2>

<p>難易度表の header.json 内の &ldquo;data_url&rdquo; の値に、作成したウェブアプリケーションの URL を設定します</p>

<p>難易度表の作成方法については以下のページが参考になるかもしれません</p>

<ul>
<li><a href="http://pmsdifficulty.xxxxxxxx.jp/column_table.html">難易度表の作成方法について - PMS Database</a></li>
<li><a href="https://github.com/exch-bms2/jbmstable-parser/wiki/%E9%9B%A3%E6%98%93%E5%BA%A6%E8%A1%A8%E3%81%AE%E4%BB%95%E6%A7%98">難易度表の仕様 · exch-bms2/jbmstable-parser Wiki</a></li>
</ul>

<p>難易度表を設置するためのサイトのホスティングサービスには
<a href="https://pages.github.com/">GitHub Pages</a> がおすすめです</p>

<ul>
<li><a href="https://pages.github.com/">GitHub Pages</a></li>
<li><a href="https://www.google.co.jp/search?q=GitHub+Pages">GitHub Pages - Google 検索</a></li>
</ul>

<h2 id="まとめ">まとめ</h2>

<p>難易度表のデータ部をスプレッドシートで管理する方法でした</p>

<p>この方法を用いることで以下のような利点があるかと思います</p>

<ul>
<li><p>スプレッドシートなのでデータの編集が簡単に行える</p></li>

<li><p>シートの変更内容が即時 json に反映されるので json を作成しウェブサイトを更新する手間が省ける</p></li>

<li><p>スプレッドシートの機能を用いた共同編集や応用も可能</p></li>

<li><p>javascript の知識があれば、GAS を用いたより高度な応用も可能</p></li>
</ul>

<p>身内間程度の表の管理などには便利なのではないでしょうか</p>

<h2 id="コードの詳細">コードの詳細</h2>

<p>一応今回用いたコードについて書いておきます</p>

<ul>
<li><p>doGet(e)</p>

<ul>
<li>ウェブアプリケーションにGETリクエストが送られた際に実行される関数。</li>
<li>返り値にHtmlOutputかTextOutputを設定。返した値が表示される。</li>
<li>doPost(e)を用いればPOSTリクエストの処理も可能。</li>
<li>引数eでパラメーターの取得が可能。 例えば&rdquo;&hellip;/exec?table=aaa&rdquo;とパラメーターをつけてアクセスすると、e.parameterには{&ldquo;table&rdquo;: &ldquo;aaa&rdquo;}が入る。 １つのスプレッドシートから複数の難易度表を管理したいときに便利。</li>
<li>詳細はこちら <a href="https://developers.google.com/apps-script/guides/web">https://developers.google.com/apps-script/guides/web</a></li>
</ul></li>

<li><p>SpreadsheetApp.openById(id).getSheetByName(sheet_name)</p>

<ul>
<li>スプレッドシートを取得する。</li>
<li>openByIdでスプレッドシートを開き、getSheetByNameでシートを開いている。</li>
<li>ウェブアプリケーションとして実行するのでgetActiveSheet()等は使わずIDで指定している。</li>
</ul></li>

<li><p>sheet.getDataRange().getValues()</p>

<ul>
<li>getDataRangeでデータが存在するすべての範囲のRangeオブジェクトを返す。</li>
<li>getValuesで範囲内のデータを二次元配列で取得。</li>
</ul></li>

<li><p>GASの詳しい詳細はこちら <a href="https://developers.google.com/apps-script/">https://developers.google.com/apps-script/</a></p></li>
</ul>
</article>

      

<div class="book-footer justify-between">
  
  <div>
    
    
      <img src="/svg/calendar.svg" alt="Changed" /> 2019-7-1
    
  </div>
  
  
</div>


      
    </div>

    
  

  
    <aside class="book-toc level-6 fixed">
      <nav id="TableOfContents">
<ul>
<li><a href="#スプレッドシートを使って難易度表を管理する">スプレッドシートを使って難易度表を管理する</a>
<ul>
<li><a href="#できること">できること</a></li>
<li><a href="#手順">手順</a></li>
<li><a href="#スプレッドシートを作成する">スプレッドシートを作成する</a></li>
<li><a href="#シートのidとシート名をメモする">シートのIDとシート名をメモする</a></li>
<li><a href="#スクリプトを作成する">スクリプトを作成する</a></li>
<li><a href="#ウェブアプリケーションとして公開する">ウェブアプリケーションとして公開する</a></li>
<li><a href="#難易度表に登録する">難易度表に登録する</a></li>
<li><a href="#まとめ">まとめ</a></li>
<li><a href="#コードの詳細">コードの詳細</a></li>
</ul></li>
</ul>
</nav>
    </aside>
  



  </main>
  
  
  
</body>

</html>
